<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Demo</title>
    <!--<link rel="stylesheet" href="css/style.css">-->
    <!--<script src="https://use.fontawesome.com/3dd7d5f3cc.js"></script>-->
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <style>
        body {
            background-color: #000;
            margin: 0;
        }

        main {
            position: relative;
        }
    </style>
</head>

<body>
    <!--<header role="banner">
        <h1>ロゴ</h1>
    </header>-->
    <nav role="navigation">
        <button id="startstop">Start</button>
        <a href="#engineer"><button>Engineer</button></a>
    </nav>
    <main role="main">
        <style scoped>
            div {
                margin: 10%;
                padding: 1em;
                border: 1px solid;
                background-color: hsla(226, 100%, 20%, 0.65);
                border-color: hsla(226, 100%, 70%, 0.65);
                color: hsla(226, 100%, 70%, 1);
            }
        </style>
        <div>
            デモサイト。ビューを選択して Start を押す。データは 10 ～ 20 秒ほど流れ始めるのに時間がかかるので、待つこと。
        </div>
    </main>
    <!--<aside role="complementary">
        サイドコンテンツ
    </aside>
    <footer role="contentinfo">
        フッター
    </footer>-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/5.3.1/Rx.min.js"></script>-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs-dom/7.0.3/rx.dom.min.js"></script>-->
    <script src="scripts/lib/rx.all.min.js"></script>
    <script src="scripts/lib/rx.dom.min.js"></script>
    <script src="scripts/lib/riot_compiler.min.js"></script>
    <script src="scripts/lib/route.min.js"></script>
    <script>
        // 蛇口
        let pauser = new Rx.Subject();
        // 水道
        let demo6901source = Rx.DOM.fromEventSource('http://demo.danmaid.com/6901/sse')
            .map(function (x) { return Rx.Observable.return(x).delay(200); }).concatAll()
            .map(function (x) {
                return JSON.parse(x);
            })
            .map(function (x) {
                x.timestamp = new Date(x.timestamp * 1000);
                return x;
            })
            .share()
            .pausable(pauser);

        // こういうのも Rx や Riot で書いたほうが便利だけど、本デモの本質ではない。
        document.getElementById('startstop').addEventListener('click', function (x) {
            if (x.target.innerText == 'Start') {
                // 開始処理
                pauser.onNext(true);
                x.target.innerText = 'Stop';
            } else {
                // 停止処理
                pauser.onNext(false);
                x.target.innerText = 'Start';
            }
        });


        route('/engineer', function () {
            riot.compile('views/engineer.tag', function () {
                riot.mount('main', 'engineer');
            });
        });
        route('/');
        route.start();
    </script>
</body>

</html>